{% extends "base.html" %}

{% block title %}–ë–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏ - TrustStaff{% endblock %}

{% block content %}
<div class="metrics-container">
    <h1>üíº –ë–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏</h1>

    <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –±–∏–∑–Ω–µ—Å-–ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ -->
    <div class="metrics-grid">
        <div class="metrics-card card-success">
            <div class="card-body">
                <h4 class="card-title">{{ metrics.total_users }}</h4>
                <p class="card-text">üë• –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
            </div>
        </div>
        
        <div class="metrics-card card-primary">
            <div class="card-body">
                <h4 class="card-title">{{ metrics.verified_users }}</h4>
                <p class="card-text">‚úÖ –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö</p>
            </div>
        </div>
        
        <div class="metrics-card card-warning">
            <div class="card-body">
                <h4 class="card-title">{{ metrics.pending_verification }}</h4>
                <p class="card-text">üü° –ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</p>
            </div>
        </div>
        
        <div class="metrics-card card-info">
            <div class="card-body">
                <h4 class="card-title">{{ metrics.total_employees }}</h4>
                <p class="card-text">üëî –í—Å–µ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</p>
            </div>
        </div>
    </div>

    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ -->
    <div class="metrics-grid">
        <div class="metrics-card card-primary">
            <div class="card-body">
                <h4 class="card-title">{{ metrics.total_records }}</h4>
                <p class="card-text">üìù –ó–∞–ø–∏—Å–µ–π –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö</p>
            </div>
        </div>
        
        <div class="metrics-card card-success">
            <div class="card-body">
                <h4 class="card-title">{{ metrics.avg_employees_per_user }}</h4>
                <p class="card-text">üìä –°—Ä–µ–¥–Ω–µ–µ –∑–∞–ø–∏—Å–µ–π/–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</p>
            </div>
        </div>
        
        <div class="metrics-card card-info">
            <div class="card-body">
                <h4 class="card-title">{{ metrics.new_users_today }}</h4>
                <p class="card-text">üÜï –ù–æ–≤—ã—Ö –∑–∞ —Å–µ–≥–æ–¥–Ω—è</p>
            </div>
        </div>
        
        <div class="metrics-card card-warning">
            <div class="card-body">
                <h4 class="card-title">{{ metrics.new_users_week }}</h4>
                <p class="card-text">üìà –ù–æ–≤—ã—Ö –∑–∞ –Ω–µ–¥–µ–ª—é</p>
            </div>
        </div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ä–æ–ª—è–º -->
    <div class="metrics-card">
        <div class="card-header">
            <h5>üë• –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ä–æ–ª—è–º</h5>
        </div>
        <div class="card-body">
            <p class="table-scroll-hint">üëà –õ–∏—Å—Ç–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É –≤–ª–µ–≤–æ-–≤–ø—Ä–∞–≤–æ üëâ</p>
            <div class="table-wrapper">
                <table class="metrics-table">
                    <thead>
                        <tr>
                            <th>–†–æ–ª—å</th>
                            <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                            <th>–ü—Ä–æ—Ü–µ–Ω—Ç</th>
                            <th>–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for role, count in metrics.users_by_role.items() %}
                        {% set percentage = (count / metrics.total_users * 100) if metrics.total_users > 0 else 0 %}
                        <tr>
                            <td><strong>{{ role }}</strong></td>
                            <td><span class="badge badge-primary">{{ count }}</span></td>
                            <td>{{ "%.1f"|format(percentage) }}%</td>
                            <td>
                                <div class="progress">
                                    <div class="progress-bar" 
                                         role="progressbar" 
                                         style="width: {{ percentage }}%;"
                                         aria-valuenow="{{ percentage }}" 
                                         aria-valuemin="0" 
                                         aria-valuemax="100">
                                    </div>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ -->
    <div class="metrics-card">
        <div class="card-header">
            <h5>‚úÖ –°—Ç–∞—Ç—É—Å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏</h5>
        </div>
        <div class="card-body">
            <p class="table-scroll-hint">üëà –õ–∏—Å—Ç–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É –≤–ª–µ–≤–æ-–≤–ø—Ä–∞–≤–æ üëâ</p>
            <div class="table-wrapper">
                <table class="metrics-table">
                    <thead>
                        <tr>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                            <th>–ü—Ä–æ—Ü–µ–Ω—Ç</th>
                            <th>–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for status, count in metrics.users_by_verification.items() %}
                        {% set percentage = (count / metrics.total_users * 100) if metrics.total_users > 0 else 0 %}
                        <tr>
                            <td>
                                {% if status == 'approved' %}
                                    <strong style="color: green;">‚úÖ –û–¥–æ–±—Ä–µ–Ω–æ</strong>
                                {% elif status == 'pending' %}
                                    <strong style="color: orange;">üü° –ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</strong>
                                {% elif status == 'rejected' %}
                                    <strong style="color: red;">‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ</strong>
                                {% else %}
                                    <strong>‚ö™ –ù–µ –ø–æ–¥–∞–Ω–æ</strong>
                                {% endif %}
                            </td>
                            <td><span class="badge badge-primary">{{ count }}</span></td>
                            <td>{{ "%.1f"|format(percentage) }}%</td>
                            <td>
                                <div class="progress">
                                    <div class="progress-bar" 
                                         role="progressbar" 
                                         style="width: {{ percentage }}%;"
                                         aria-valuenow="{{ percentage }}" 
                                         aria-valuemin="0" 
                                         aria-valuemax="100">
                                    </div>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- –¢–æ–ø –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
    <div class="metrics-card">
        <div class="card-header">
            <h5>üèÜ –¢–æ–ø-10 –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h5>
        </div>
        <div class="card-body">
            {% if metrics.top_users %}
                <p class="table-scroll-hint">üëà –õ–∏—Å—Ç–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É –≤–ª–µ–≤–æ-–≤–ø—Ä–∞–≤–æ üëâ</p>
                <div class="table-wrapper">
                    <table class="metrics-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Email</th>
                                <th>–ö–æ–º–ø–∞–Ω–∏—è</th>
                                <th>–ó–∞–ø–∏—Å–µ–π</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for user in metrics.top_users %}
                            <tr>
                                <td>{{ loop.index }}</td>
                                <td>{{ user.email }}</td>
                                <td>{{ user.company_name or '–ù–µ —É–∫–∞–∑–∞–Ω–∞' }}</td>
                                <td><span class="badge badge-primary">{{ user.employee_count }}</span></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö</p>
            {% endif %}
        </div>
    </div>

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div class="metrics-card">
        <div class="card-header">
            <h5>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h5>
        </div>
        <div class="card-body">
            <p><strong>üë§ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä:</strong> {{ metrics.admin_viewing }}</p>
            <p><strong>üìÖ –î–∞—Ç–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞:</strong> {{ metrics.timestamp }}</p>
            <p><strong>üí° –ö–æ–Ω–≤–µ—Ä—Å–∏—è –≤ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é:</strong> 
                {{ "%.1f"|format(metrics.conversion_rate) }}%
            </p>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ -->
    <div class="metrics-buttons">
        <button class="big-button" onclick="location.reload()">
            üîÑ –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
        </button>
        <a href="/admin/metrics" class="big-button">
            üìä –°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
        </a>
        <a href="/admin/review" class="big-button">
            ‚Üê –ù–∞–∑–∞–¥ –∫ –∞–¥–º–∏–Ω–∫–µ
        </a>
    </div>
</div>
{% endblock %}
