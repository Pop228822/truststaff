{% extends "base.html" %}

{% block title %}–ú–µ—Ç—Ä–∏–∫–∏ —Å–∏—Å—Ç–µ–º—ã - TrustStaff{% endblock %}

{% block content %}
<div class="metrics-container">
    <h1>üìä –ú–µ—Ç—Ä–∏–∫–∏ —Å–∏—Å—Ç–µ–º—ã</h1>

    <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ -->
    <div class="metrics-grid">
        <div class="metrics-card card-primary">
            <div class="card-body">
                <h4 class="card-title">{{ metrics.uptime_human }}</h4>
                <p class="card-text">‚è∞ –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã</p>
            </div>
        </div>
        
        <div class="metrics-card card-success">
            <div class="card-body">
                <h4 class="card-title">{{ metrics.total_requests }}</h4>
                <p class="card-text">üåê –í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤</p>
            </div>
        </div>
        
        <div class="metrics-card card-warning">
            <div class="card-body">
                <h4 class="card-title">{{ metrics.total_errors }}</h4>
                <p class="card-text">‚ö†Ô∏è –û—à–∏–±–æ–∫</p>
            </div>
        </div>
        
        <div class="metrics-card card-info">
            <div class="card-body">
                <h4 class="card-title">{{ metrics.requests_by_endpoint|length }}</h4>
                <p class="card-text">üîó –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö endpoints</p>
            </div>
        </div>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö endpoints -->
    <div class="metrics-card">
        <div class="card-header">
            <h5>üìã –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ endpoints</h5>
        </div>
        <div class="card-body">
            {% if metrics.requests_by_endpoint %}
                <p class="table-scroll-hint">üëà –õ–∏—Å—Ç–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É –≤–ª–µ–≤–æ-–≤–ø—Ä–∞–≤–æ üëâ</p>
                <div class="table-wrapper">
                    <table class="metrics-table">
                        <thead>
                            <tr>
                                <th>Endpoint</th>
                                <th>–ó–∞–ø—Ä–æ—Å–æ–≤</th>
                                <th>–ü—Ä–æ—Ü–µ–Ω—Ç</th>
                                <th>–ü—Ä–æ–≥—Ä–µ—Å—Å</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for endpoint, count in metrics.requests_by_endpoint.items() %}
                            {% set percentage = (count / metrics.total_requests * 100) if metrics.total_requests > 0 else 0 %}
                            <tr>
                                <td>
                                    <code>{{ endpoint }}</code>
                                </td>
                                <td>
                                    <span class="badge badge-primary">{{ count }}</span>
                                </td>
                                <td>{{ "%.1f"|format(percentage) }}%</td>
                                <td>
                                    <div class="progress">
                                        <div class="progress-bar" 
                                             role="progressbar" 
                                             style="width: {{ percentage }}%;"
                                             aria-valuenow="{{ percentage }}" 
                                             aria-valuemin="0" 
                                             aria-valuemax="100">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –∑–∞–ø—Ä–æ—Å–∞—Ö</p>
            {% endif %}
        </div>
    </div>

    <!-- –û—à–∏–±–∫–∏ -->
    {% if metrics.errors_by_status %}
    <div class="metrics-card card-danger">
        <div class="card-header">
            <h5>üö® –û—à–∏–±–∫–∏ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º</h5>
        </div>
        <div class="card-body">
            <div class="metrics-grid">
                {% for status, count in metrics.errors_by_status.items() %}
                <div class="alert alert-danger">
                    <strong>HTTP {{ status }}:</strong> {{ count }} –æ—à–∏–±–æ–∫
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Å—Å–∏–∏ -->
    <div class="metrics-card">
        <div class="card-header">
            <h5>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Å—Å–∏–∏</h5>
        </div>
        <div class="card-body">
            <p><strong>üë§ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä:</strong> {{ metrics.admin_viewing }}</p>
            <p><strong>üìÖ –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:</strong> {{ metrics.timestamp }}</p>
            <p><strong>‚è±Ô∏è –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã (—Å–µ–∫—É–Ω–¥—ã):</strong> {{ "%.2f"|format(metrics.uptime_seconds) }}</p>
            <p><strong>‚ö° –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏:</strong> 
                {% if metrics.total_requests > 0 %}
                    {{ "%.2f"|format(metrics.uptime_seconds / metrics.total_requests) }} —Å–µ–∫
                {% else %}
                    –ù/–î
                {% endif %}
            </p>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ -->
    <div class="metrics-buttons">
        <button class="big-button" onclick="location.reload()">
            üîÑ –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
        </button>
        <a href="/admin/review" class="big-button">
            ‚Üê –ù–∞–∑–∞–¥ –∫ –∞–¥–º–∏–Ω–∫–µ
        </a>
    </div>
</div>
{% endblock %}
