{% extends "base.html" %}
{% block content %}
<div class="record-form">
    <h2 style="text-align: center;">Верификация работодателя</h2>
    <form method="post" enctype="multipart/form-data">
        <div class="form-group">
            <label for="company_name">Название компании / ИП</label>
            <!-- Важно иметь id="company_name" для автокомплита -->
            <input type="text" name="company_name" id="company_name" required>
        </div>

        <div class="form-group">
            <label for="city">Город регистрации</label>
            <!-- id="city" чтобы заполнить из DaData (адрес) -->
            <input type="text" name="city" id="city" required>
        </div>

        <div class="form-group">
            <label for="inn_or_ogrn">ИНН / ОГРНИП / ОГРН</label>
            <!-- id="inn_or_ogrn" чтобы заполнить из DaData -->
            <input type="text" name="inn_or_ogrn" id="inn_or_ogrn" required>
        </div>

        <div class="form-group">
            <label for="passport_file">Фото паспорта (1-я страница)</label>
            <input type="file" name="passport_file" id="passport_file" accept="image/*,.pdf" required>
        </div>

        {% if error_message %}
            <p style="color: red; font-weight: bold;">{{ error_message }}</p>
        {% endif %}

        <div style="text-align: center;">
            <button type="submit" class="big-button">Отправить на проверку</button>
        </div>
    </form>
</div>

<!-- Подключаем автокомплит DaData именно здесь или в base.html -->
<script>
$(function(){
    // Инициализируем автокомплит на поле company_name
    $("#company_name").suggestions({
        token: "6dfe3680159819e4134cf07cb9a92d899f8d3b1f",
        type: "PARTY",   // Поиск по организациям (юрлица + ИП)
        onSelect: function (suggestion) {
            // suggestion.value = "ООО Ромашка"
            $("#company_name").val(suggestion.value);

            // ИНН
            if (suggestion.data.inn) {
                $("#inn_or_ogrn").val(suggestion.data.inn);
            }
            // ОГРН / ОГРНИП
            // suggestion.data.ogrn, suggestion.data.ogrn_ip (для ИП) и т.д.

            // Адрес
            if (suggestion.data.address && suggestion.data.address.value) {
                // Город может содержаться в address.data.city
                // Или в address.value (полный адрес)
                $("#city").val(suggestion.data.address.data.city
                               || suggestion.data.address.value);
            }
        }
    });
});
</script>
{% endblock %}
